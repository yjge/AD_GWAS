rm(list=ls())library(usethis)library(devtools)library(TwoSampleMR)library(MRInstruments)library(data.table)library(ggplot2)outcome<-as.data.frame(fread("GWAS.txt.gz",header=T))outcome<-format_data(outcome,type = "outcome",snp_col = "SNP",                     beta_col = "BETA",se_col = "SE",  eaf_col = "FREQ",                     effect_allele_col = "A1", other_allele_col = "A2",pval_col = "P",                     samplesize_col = "N", min_pval = 1e-200,   chr_col = "CHR",  pos_col = "BP")id<-read.csv("bbj_gwasid.csv",sep = ",",header=T)id = as.list(id$GWASID)exposure <-NULLdat<-NULLresults<-NULLresults_OR<-NULLheterogeneity<-NULLpleiotropy<-NULLscatter_plot<-NULLleaveoneout<-NULLleaveoneout_plot<-NULLsingle<-NULLforest_plot<-NULLfunnel_plot<-NULLfor (i in 1:length(id)){  print(i)  exposure[[i]] <- extract_instruments(outcomes = id[[i]],p1 = 5e-08)  dat[[i]] <- harmonise_data(exposure_dat = exposure[[i]], outcome_dat = outcome)  write.table(dat[[i]],paste0("./results/",id[[i]],"_data.csv"),row.names=FALSE,col.names=TRUE,sep=",")  results[[i]] <- mr(dat[[i]])  write.table(results[[i]],paste0("./results/",id[[i]],"_results.csv"),row.names=FALSE,col.names=TRUE,sep=",")  results_OR[[i]] <- generate_odds_ratios(results[[i]])  write.table(results_OR[[i]],paste0("./results/",id[[i]],"_results_OR.csv"),row.names=FALSE,col.names=TRUE,sep=",")  heterogeneity[[i]] <- mr_heterogeneity(dat[[i]])  write.table(heterogeneity[[i]],paste0("./results/",id[[i]],"_heterogeneity.csv"),row.names=FALSE,col.names=TRUE,sep=",")  pleiotropy[[i]] <- mr_pleiotropy_test(dat[[i]])  write.table(pleiotropy[[i]],paste0("./results/",id[[i]],"_pleiotropy.csv"),row.names=FALSE,col.names=TRUE,sep=",")  results[[i]] <- results[[i]][-4,]  scatter_plot[[i]]<- mr_scatter_plot(results[[i]], dat[[i]])  ggsave(scatter_plot[[i]][[1]], file=paste0("./results/",id[[i]],"_scatter_plot.pdf"), width=6, height=6)  leaveoneout[[i]] <- mr_leaveoneout(dat[[i]])  write.table(leaveoneout[[i]],paste0("./results/",id[[i]],"_leave_one_out.csv"),row.names=FALSE,col.names=TRUE,sep=",")  leaveoneout_plot[[i]] <- mr_leaveoneout_plot(leaveoneout[[i]])  ggsave(leaveoneout_plot[[i]][[1]], file=paste0("./results/",id[[i]],"_leave_one_out_plot.pdf"), width=6, height=13)  single[[i]] <- mr_singlesnp(dat[[i]])  write.table(single[[i]],paste0("./results/",id[[i]],"_single_variant.csv"),row.names=FALSE,col.names=TRUE,sep=",")  forest_plot[[i]] <- mr_forest_plot(single[[i]])  ggsave(forest_plot[[i]][[1]], file=paste0("./results/",id[[i]],"_forest_plot.pdf"), width=6, height=13)  funnel_plot[[i]] <- mr_funnel_plot(single[[i]])  ggsave(funnel_plot[[i]][[1]], file=paste0("./results/",id[[i]],"_funnel_plot.pdf"), width=6, height=6)  dat[[i]]<-NULL  results[[i]]<-NULL  heterogeneity[[i]]<-NULL  pleiotropy[[i]]<-NULL  scatter_plot[[i]]<-NULL  leaveoneout[[i]]<-NULL  leaveoneout_plot[[i]]<-NULL  single[[i]]<-NULL  forest_plot[[i]]<-NULL  funnel_plot[[i]]<-NULL}  